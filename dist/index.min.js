(()=>{var{defineProperty:T,getOwnPropertyNames:p,getOwnPropertyDescriptor:a}=Object,r=Object.prototype.hasOwnProperty;var E=new WeakMap,s=(b)=>{var x=E.get(b),j;if(x)return x;if(x=T({},"__esModule",{value:!0}),b&&typeof b==="object"||typeof b==="function")p(b).map((K)=>!r.call(x,K)&&T(x,K,{get:()=>b[K],enumerable:!(j=a(b,K))||j.enumerable}));return E.set(b,x),x};var i=(b,x)=>{for(var j in x)T(b,j,{get:x[j],enumerable:!0,configurable:!0,set:(K)=>x[j]=()=>K})};var b0={};i(b0,{default:()=>w});var U=`.reactions-votes {\r
	position: absolute;\r
	top: 0;\r
	right: 0;\r
	display: flex;\r
	flex-direction: column;\r
	align-items: center;\r
	justify-content: center;\r
	gap: 4px;\r
	font-size: 20px;\r
}\r
.reactions-votes-button {\r
	display: flex;\r
	align-items: center;\r
	justify-content: center;\r
	gap: 4px;\r
	padding: 4px;\r
	border-radius: 4px;\r
	cursor: pointer;\r
	user-select: none;\r
	transition:\r
		background-color 0.3s,\r
		color 0.3s;\r
	background-color: transparent;\r
	color: #000;\r
}\r
.reactions-votes-button-upvote:hover {\r
	background-color: rgba(34, 197, 94, 0.1);\r
}\r
.reactions-votes-button-downvote:hover {\r
	background-color: rgba(239, 68, 68, 0.1);\r
}\r
.reactions-votes-button-downvote.reactions-user-choice {\r
	background-color: rgba(239, 68, 68, 0.15);\r
}\r
.reactions-votes-button-upvote.reactions-user-choice {\r
	background-color: rgba(34, 197, 94, 0.15);\r
}\r
\r
.reactions-reactions {\r
	position: absolute;\r
	bottom: 0;\r
	right: 0;\r
	overflow: hidden;\r
	font-size: 16px;\r
}\r
.reactions-reactions-options {\r
	display: flex;\r
}\r
.reactions-reactions-option {\r
	display: flex;\r
	align-items: center;\r
	justify-content: center;\r
	gap: 4px;\r
	padding: 4px;\r
	border-radius: 4px;\r
	cursor: pointer;\r
	user-select: none;\r
	transition:\r
		background-color 0.3s,\r
		color 0.3s;\r
}\r
\r
.reactions-reactions-option:hover {\r
	background-color: rgba(34, 197, 94, 0.1);\r
}\r
.reactions-reactions-option.reactions-user-choice {\r
	background-color: rgba(34 197 94, 0.35);\r
}\r
.reactions-reactions-option-count[data-count="0"] {\r
	display: none;\r
}\r
`;var o={votes:!0,reactions:!0,selectors:{post:".post-normal",reactionsContainer:"td:has(>.postcolor)"},pidFn:({reactionsContainer:b})=>`${b.id}`.split("_")[1]||"",server:"https://jcink-reactions.nicket.dev",performance:{debounceMs:300,cacheEnabled:!0,cacheTTL:300000,maxRetries:3,retryDelay:1000,retryBackoff:"exponential"},ui:{optimisticUpdates:!0,showLoadingStates:!0,animationDuration:200,showErrorNotifications:!0,notificationDuration:5000,accessibility:{announceChanges:!0,keyboardNavigation:!0}},customization:{reactionIcons:{heart:"❤️",laugh:"\uD83D\uDE02",clap:"\uD83D\uDC4F",thinking:"\uD83E\uDD14",sad:"\uD83D\uDE22",angry:"\uD83D\uDE20",confused:"\uD83D\uDE15",thumbsup:"\uD83D\uDC4D",thumbsdown:"\uD83D\uDC4E"},cssClasses:{userChoice:"reactions-user-choice",loading:"reactions-loading",disabled:"reactions-disabled"},labels:{vote:{like:"Like this post",dislike:"Dislike this post"},reactions:{heart:"Love",laugh:"Funny",clap:"Applause",thinking:"Thoughtful",sad:"Sad",angry:"Angry",confused:"Confused",thumbsup:"Thumbs up",thumbsdown:"Thumbs down"}}},hooks:{}};function R(b={}){let x=I(o,b);return t(x),x}function I(b,x){let j={...b};for(let K in x)if(x[K]&&typeof x[K]==="object"&&!Array.isArray(x[K]))j[K]=I(b[K]||{},x[K]);else j[K]=x[K];return j}function t(b){if(!b.server||typeof b.server!=="string")throw new Error("Server URL is required and must be a string");try{new URL(b.server)}catch{throw new Error("Server URL must be a valid URL")}if(!b.selectors.post||!b.selectors.reactionsContainer)throw new Error("Post and reactions container selectors are required");if(b.performance.debounceMs<0)throw new Error("Debounce delay must be non-negative");if(b.performance.maxRetries<1)throw new Error("Max retries must be at least 1");if(b.performance.retryDelay<0)throw new Error("Retry delay must be non-negative");if(b.ui.animationDuration<0)throw new Error("Animation duration must be non-negative");if(b.ui.notificationDuration<0)throw new Error("Notification duration must be non-negative");if(b.reactions&&Object.keys(b.customization.reactionIcons).length===0)throw new Error("At least one reaction icon must be defined when reactions are enabled")}class k extends Error{status;isRetryable;constructor(b,x,j=!0){super(b);this.status=x;this.isRetryable=j;this.name="NetworkError"}}class A extends Error{constructor(b="Authentication required"){super(b);this.name="AuthenticationError"}}async function h(b,x){let j;for(let K=1;K<=x.maxAttempts;K++)try{return await b()}catch(Q){if(j=Q,Q instanceof A)throw Q;if(Q instanceof k&&!Q.isRetryable)throw Q;if(K===x.maxAttempts)throw j;let Y=x.delay;if(x.backoff==="exponential")Y=x.delay*Math.pow(2,K-1);else if(x.backoff==="linear")Y=x.delay*K;await new Promise((X)=>setTimeout(X,Y))}throw j}class S{static instance;container=null;static getInstance(){if(!S.instance)S.instance=new S;return S.instance}createContainer(){if(this.container)return this.container;return this.container=document.createElement("div"),this.container.id="reactions-error-container",this.container.style.cssText=`
			position: fixed;
			top: 20px;
			right: 20px;
			z-index: 10000;
			max-width: 400px;
		`,document.body.appendChild(this.container),this.container}show(b,x="error",j=5000){let K=this.createContainer(),Q=document.createElement("div");Q.style.cssText=`
			background: ${x==="error"?"#f56565":x==="warning"?"#ed8936":"#4299e1"};
			color: white;
			padding: 12px 16px;
			margin-bottom: 8px;
			border-radius: 4px;
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			opacity: 0;
			transform: translateX(100%);
			transition: all 0.3s ease;
		`,Q.textContent=b,K.appendChild(Q),requestAnimationFrame(()=>{Q.style.opacity="1",Q.style.transform="translateX(0)"}),setTimeout(()=>{Q.style.opacity="0",Q.style.transform="translateX(100%)",setTimeout(()=>{if(Q.parentNode)Q.parentNode.removeChild(Q)},300)},j)}showError(b){let x="An unexpected error occurred";if(b instanceof A)x="Please log in to vote or react to posts";else if(b instanceof k)x=b.status===429?"Too many requests. Please wait a moment.":"Network error. Please check your connection.";this.show(x,"error")}}class D{config;topicId;errorNotifier=S.getInstance();constructor(b,x){this.config=b,this.topicId=x}async get(b,x){let j=new URLSearchParams(x?.query);return j.set("forumUrl",location.origin),j.set("topicId",this.topicId),console.log({server:this.config.server,path:b,query:`${j}`}),h(async()=>{let K=await fetch(`${this.config.server}${b}?${j}`,{headers:{"Content-Type":"application/json"}});if(!K.ok)throw new k(`GET ${b} failed`,K.status,K.status>=500||K.status===429);return K},{maxAttempts:this.config.performance.maxRetries,delay:this.config.performance.retryDelay,backoff:this.config.performance.retryBackoff})}async put(b,x){return h(async()=>{try{let j=await authcinkPromise.then((Q)=>Q.authenticate()),K=await fetch(`${this.config.server}${b}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${j}`},body:JSON.stringify(x)});if(!K.ok){if(K.status===401||K.status===403)throw new A;throw new k(`PUT ${b} failed`,K.status,K.status>=500||K.status===429)}return K}catch(j){if(j instanceof k||j instanceof A)throw j;throw new A("Authentication failed")}},{maxAttempts:this.config.performance.maxRetries,delay:this.config.performance.retryDelay,backoff:this.config.performance.retryBackoff})}}function y(){let b=document.getElementById("logged-in-as");if(!b?.href)return null;let j=new URL(b.href).searchParams.get("showuser");return j?{userId:parseInt(j)}:null}function f(b){let x=document.createElement("style");x.textContent=b,document.head.appendChild(x)}function _(b,x){if(!b)return;b.textContent=x.toString(),b.setAttribute("data-count",x.toString())}function G(b){if(!b)return 0;return parseInt(b.getAttribute("data-count")||"0")}function F(b,x,j){if(j)b.classList.add(x);else b.classList.remove(x)}function O(b,x){b.forEach((j)=>j.classList.remove(x))}class N{updates=new Map;applyVoteUpdate(b,x,j,K,Q){let Y=`vote-${x}-${Date.now()}`,X=b.upvote?.classList.contains("reactions-user-choice")||!1,$=b.downvote?.classList.contains("reactions-user-choice")||!1,Z=b.upvote?G(b.upvote.querySelector(".reactions-votes-count")):0,W=b.downvote?G(b.downvote.querySelector(".reactions-votes-count")):0;if(j==="like"){if(b.upvote){F(b.upvote,"reactions-user-choice",!K);let z=Z,q=W;if(Q==="dislike"&&!K){if(q=Math.max(0,W-1),z=Z+1,b.downvote)_(b.downvote.querySelector(".reactions-votes-count"),q)}else z=K?Math.max(0,Z-1):Z+1;_(b.upvote.querySelector(".reactions-votes-count"),z)}if(b.downvote)b.downvote.classList.remove("reactions-user-choice")}else{if(b.downvote){F(b.downvote,"reactions-user-choice",!K);let z=Z,q=W;if(Q==="like"&&!K){if(z=Math.max(0,Z-1),q=W+1,b.upvote)_(b.upvote.querySelector(".reactions-votes-count"),z)}else q=K?Math.max(0,W-1):W+1;_(b.downvote.querySelector(".reactions-votes-count"),q)}if(b.upvote)b.upvote.classList.remove("reactions-user-choice")}let J=()=>{if(b.upvote)F(b.upvote,"reactions-user-choice",X),_(b.upvote.querySelector(".reactions-votes-count"),Z);if(b.downvote)F(b.downvote,"reactions-user-choice",$),_(b.downvote.querySelector(".reactions-votes-count"),W)};return this.updates.set(Y,{id:Y,type:"vote",postId:x,rollback:J}),Y}applyReactionUpdate(b,x,j,K,Q){let Y=`reaction-${x}-${Date.now()}`;if(!b.reactions)return Y;let X=b.reactions.querySelectorAll(".reactions-reactions-option"),$=Array.from(X).map((J)=>({element:J,active:J.classList.contains("reactions-user-choice"),count:G(J.querySelector(".reactions-reactions-option-count"))})),Z=Array.from(X).find((J)=>J.getAttribute("aria-label")===j);if(Z){if(O(X,"reactions-user-choice"),!K)Z.classList.add("reactions-user-choice");if(Q&&Q!==j){let J=Array.from(X).find((L)=>L.getAttribute("aria-label")===Q);if(J){let L=J.querySelector(".reactions-reactions-option-count"),H=G(L);_(L,Math.max(0,H-1))}let z=Z.querySelector(".reactions-reactions-option-count"),q=G(z);_(z,q+1)}else{let J=Z.querySelector(".reactions-reactions-option-count"),z=G(J),q=K?Math.max(0,z-1):z+1;_(J,q)}}let W=()=>{$.forEach(({element:J,active:z,count:q})=>{F(J,"reactions-user-choice",z),_(J.querySelector(".reactions-reactions-option-count"),q)})};return this.updates.set(Y,{id:Y,type:"reaction",postId:x,rollback:W}),Y}commit(b){this.updates.delete(b)}rollback(b){let x=this.updates.get(b);if(x)x.rollback(),this.updates.delete(b)}rollbackPost(b){Array.from(this.updates.values()).filter((j)=>j.postId===b).forEach((j)=>{j.rollback(),this.updates.delete(j.id)})}clear(){this.updates.clear()}}class M{userChoices;loadingStates;optimisticManager;constructor(){this.userChoices={votes:new Map,reactions:new Map},this.loadingStates={votes:new Set,reactions:new Set},this.optimisticManager=new N}setUserVote(b,x){this.userChoices.votes.set(b,x)}getUserVote(b){return this.userChoices.votes.get(b)||null}setUserReaction(b,x){this.userChoices.reactions.set(b,x)}getUserReaction(b){return this.userChoices.reactions.get(b)||null}isVoteLoading(b){return this.loadingStates.votes.has(b)}setVoteLoading(b,x){if(x)this.loadingStates.votes.add(b);else this.loadingStates.votes.delete(b)}isReactionLoading(b){return this.loadingStates.reactions.has(b)}setReactionLoading(b,x){if(x)this.loadingStates.reactions.add(b);else this.loadingStates.reactions.delete(b)}applyOptimisticVote(b,x,j,K){let Q=this.getUserVote(x),Y=this.optimisticManager.applyVoteUpdate(b,x,j,K,Q);return{updateId:Y,commit:()=>this.optimisticManager.commit(Y),rollback:()=>this.optimisticManager.rollback(Y)}}applyOptimisticReaction(b,x,j,K){let Q=this.getUserReaction(x),Y=this.optimisticManager.applyReactionUpdate(b,x,j,K,Q);return{updateId:Y,commit:()=>this.optimisticManager.commit(Y),rollback:()=>this.optimisticManager.rollback(Y)}}rollbackPost(b){this.optimisticManager.rollbackPost(b)}}function v(b,x){let j=null;return(...K)=>{if(j)clearTimeout(j);j=setTimeout(()=>{b(...K),j=null},x)}}function C(b,x){let j=Object.assign(document.createElement("div"),{className:"reactions-votes"}),K=null,Q=null;if(b.votes){if(K=Object.assign(document.createElement("div"),{className:"reactions-votes-button reactions-votes-button-upvote",innerHTML:`
				<div class="reactions-votes-icon">\uD83D\uDC4D</div>
				<div class="reactions-votes-count" data-count="0">0</div>
			`}),j.appendChild(K),b.votes===!0)Q=Object.assign(document.createElement("div"),{className:"reactions-votes-button reactions-votes-button-downvote",innerHTML:`
					<div class="reactions-votes-icon">\uD83D\uDC4E</div>
					<div class="reactions-votes-count" data-count="0">0</div>
				`}),j.appendChild(Q);x.appendChild(j)}return{votes:j,upvote:K,downvote:Q}}function e(b,x,j,K){if(x==="like"){if(F(b.upvote,"reactions-user-choice",!j),b.downvote)b.downvote.classList.remove("reactions-user-choice");if(K==="dislike"&&!j){if(b.downvote){let X=b.downvote.querySelector(".reactions-votes-count"),$=G(X);_(X,Math.max(0,$-1))}let Q=b.upvote.querySelector(".reactions-votes-count"),Y=G(Q);_(Q,Y+1)}else{let Q=b.upvote.querySelector(".reactions-votes-count"),Y=G(Q),X=j?Math.max(0,Y-1):Y+1;_(Q,X)}}else{if(F(b.downvote,"reactions-user-choice",!j),b.upvote)b.upvote.classList.remove("reactions-user-choice");if(K==="like"&&!j){if(b.upvote){let X=b.upvote.querySelector(".reactions-votes-count"),$=G(X);_(X,Math.max(0,$-1))}let Q=b.downvote.querySelector(".reactions-votes-count"),Y=G(Q);_(Q,Y+1)}else{let Q=b.downvote.querySelector(".reactions-votes-count"),Y=G(Q),X=j?Math.max(0,Y-1):Y+1;_(Q,X)}}}function g(b,x,j,K,Q,Y){let X=S.getInstance(),$=v(async(Z)=>{if(Q.isVoteLoading(x))return;Q.setVoteLoading(x,!0);let W=Z==="like"?b.upvote.classList.contains("reactions-user-choice"):b.downvote.classList.contains("reactions-user-choice"),J=Q.getUserVote(x),z=null;if(Y.ui.optimisticUpdates)z=Q.applyOptimisticVote(b,x,Z,W);try{let q=await K.put(`/topics/${j}/posts/${x}/vote`,{type:W?null:Z});if(q.ok){let L=W?null:Z;if(Q.setUserVote(x,L),z)z.commit();else e(b,Z,W,J)}else throw new Error(`Vote request failed with status ${q.status}`)}catch(q){if(z)z.rollback();if(Y.ui.showErrorNotifications)X.showError(q);console.error("Failed to vote:",q)}finally{Q.setVoteLoading(x,!1)}},Y.performance.debounceMs);if(b.upvote)b.upvote.addEventListener("click",(Z)=>{Z.preventDefault(),Z.stopPropagation(),$("like")});if(b.downvote)b.downvote.addEventListener("click",(Z)=>{Z.preventDefault(),Z.stopPropagation(),$("dislike")})}function d(b,x,j,K){let Q=new Map,Y=new Map;b.forEach((X)=>{let $=X.postId.toString(),Z=X.voteType;if(!Q.has($))Q.set($,{like:0,dislike:0});let W=Q.get($);if(W[Z]=(W[Z]||0)+1,j&&X.userId===j.userId)Y.set($,Z),K.setUserVote($,Z)}),x.forEach((X,$)=>{let Z=Q.get($)||{like:0,dislike:0},W=Y.get($);if(X.upvote){let J=X.upvote.querySelector(".reactions-votes-count");_(J,Z.like),F(X.upvote,"reactions-user-choice",W==="like")}if(X.downvote){let J=X.downvote.querySelector(".reactions-votes-count");_(J,Z.dislike),F(X.downvote,"reactions-user-choice",W==="dislike")}})}function m(b,x){if(!b.reactions)return null;let j=Object.assign(document.createElement("div"),{className:"reactions-reactions"}),K=Object.assign(document.createElement("div"),{className:"reactions-reactions-options"});return Object.entries(b.customization.reactionIcons).forEach(([Q,Y])=>{let X=document.createElement("div");X.className="reactions-reactions-option",X.innerHTML=`<div class="reactions-reactions-option-icon">${Y}</div>
			<div class="reactions-reactions-option-count" data-count="0">0</div>`,X.setAttribute("aria-label",Q),X.setAttribute("role","button"),X.setAttribute("tabindex","0"),K.appendChild(X)}),j.appendChild(K),x.appendChild(j),j}function c(b,x,j,K,Q,Y){if(!b.reactions)return;let X=b.reactions.querySelectorAll(".reactions-reactions-option");X.forEach(($)=>{$.addEventListener("click",async(Z)=>{if(Z.preventDefault(),Z.stopPropagation(),Q.isReactionLoading(x))return;Q.setReactionLoading(x,!0);try{let W=$.getAttribute("aria-label"),J=$.classList.contains("reactions-user-choice"),z=Q.getUserReaction(x);if((await K.put(`/topics/${j}/posts/${x}/reaction`,{reaction:J?null:W})).ok){let L=J?null:W;if(Q.setUserReaction(x,L),O(X,"reactions-user-choice"),!J)$.classList.add("reactions-user-choice");if(z&&z!==W){let H=Array.from(X).find((P)=>P.getAttribute("aria-label")===z);if(H){let P=H.querySelector(".reactions-reactions-option-count"),u=G(P);_(P,Math.max(0,u-1))}let B=$.querySelector(".reactions-reactions-option-count"),V=G(B);_(B,V+1)}else if(z===W){let H=$.querySelector(".reactions-reactions-option-count"),B=G(H);_(H,Math.max(0,B-1))}else if(!z){let H=$.querySelector(".reactions-reactions-option-count"),B=G(H);_(H,B+1)}}}catch(W){console.error("Failed to react:",W)}finally{Q.setReactionLoading(x,!1)}})})}function l(b,x,j,K){let Q=new Map,Y=new Map;b.forEach((X)=>{let $=X.postId.toString(),Z=X.reaction;if(!Q.has($))Q.set($,new Map);let W=Q.get($);if(W.set(Z,(W.get(Z)||0)+1),j&&X.userId===j.userId)Y.set($,Z),K.setUserReaction($,Z)}),x.forEach((X,$)=>{if(!X.reactions)return;let Z=Q.get($)||new Map,W=Y.get($);X.reactions.querySelectorAll(".reactions-reactions-option").forEach((z)=>{let q=z.getAttribute("aria-label"),L=Z.get(q)||0,H=z.querySelector(".reactions-reactions-option-count");_(H,L),F(z,"reactions-user-choice",W===q)})})}async function w(b){let x=R(b),j=new URL(location.href),K=j.searchParams.get("showtopic")||(j.searchParams.get("act")==="ST"?j.searchParams.get("t"):null);if(console.log({topicId:K,showtopic:j.searchParams.get("showtopic")}),!K)return;let Q=y();f(U);let Y=new D(x,K),X=new M,$=new Map;document.querySelectorAll(x.selectors.post).forEach((J)=>{let z=J.querySelector(x.selectors.reactionsContainer);if(!z)return;z.style.position="relative";let{votes:q,upvote:L,downvote:H}=C(x,z),B=m(x,z),V={post:J,reactionsContainer:z,votes:q,upvote:L,downvote:H,reactions:B||void 0},P=x.pidFn(V);$.set(P,V),g(V,P,K,Y,X,x),c(V,P,K,Y,X,x)});let W=Array.from($.keys());if(x.reactions)try{let z=await(await Y.get("/reactions",{query:{postIds:W.join(",")}})).json();l(z,$,Q,X)}catch(J){console.error("Failed to load reactions:",J)}if(x.votes)try{let z=await(await Y.get("/votes",{query:{postIds:W.join(",")}})).json();d(z,$,Q,X)}catch(J){console.error("Failed to load votes:",J)}}window.Reactions=w;})();
