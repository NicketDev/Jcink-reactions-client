(()=>{var{defineProperty:D,getOwnPropertyNames:i,getOwnPropertyDescriptor:s}=Object,n=Object.prototype.hasOwnProperty;var E=new WeakMap,o=(b)=>{var x=E.get(b),j;if(x)return x;if(x=D({},"__esModule",{value:!0}),b&&typeof b==="object"||typeof b==="function")i(b).map((Y)=>!n.call(x,Y)&&D(x,Y,{get:()=>b[Y],enumerable:!(j=s(b,Y))||j.enumerable}));return E.set(b,x),x};var t=(b,x)=>{for(var j in x)D(b,j,{get:x[j],enumerable:!0,configurable:!0,set:(Y)=>x[j]=()=>Y})};var X0={};t(X0,{default:()=>M});var R=`.reactions-votes {\r
	position: absolute;\r
	top: 0;\r
	right: 0;\r
	display: flex;\r
	flex-direction: column;\r
	align-items: center;\r
	justify-content: center;\r
	gap: 4px;\r
	font-size: 20px;\r
}\r
.reactions-votes-button {\r
	display: flex;\r
	align-items: center;\r
	justify-content: center;\r
	gap: 4px;\r
	padding: 4px;\r
	border-radius: 4px;\r
	cursor: pointer;\r
	user-select: none;\r
	transition:\r
		background-color 0.3s,\r
		color 0.3s;\r
	background-color: transparent;\r
	color: #000;\r
}\r
.reactions-votes-button-upvote:hover {\r
	background-color: rgba(34, 197, 94, 0.1);\r
}\r
.reactions-votes-button-downvote:hover {\r
	background-color: rgba(239, 68, 68, 0.1);\r
}\r
.reactions-votes-button-downvote.reactions-user-choice {\r
	background-color: rgba(239, 68, 68, 0.15);\r
}\r
.reactions-votes-button-upvote.reactions-user-choice {\r
	background-color: rgba(34, 197, 94, 0.15);\r
}\r
\r
.reactions-reactions {\r
	position: absolute;\r
	bottom: 0;\r
	right: 0;\r
	font-size: 16px;\r
}\r
\r
/* Compact view styles */\r
.reactions-compact-view {\r
	display: flex;\r
	align-items: center;\r
	gap: 4px;\r
	margin: 4px;\r
	opacity: 1;\r
	transition: opacity 0.2s ease;\r
}\r
\r
.reactions-add-button {\r
	display: flex;\r
	align-items: center;\r
	justify-content: center;\r
	padding: 4px 8px;\r
	border-radius: 12px;\r
	cursor: pointer;\r
	user-select: none;\r
	transition: background-color 0.2s ease;\r
	background-color: rgba(0, 0, 0, 0.05);\r
	font-size: 18px;\r
}\r
\r
.reactions-add-button:hover {\r
	background-color: rgba(0, 0, 0, 0.1);\r
}\r
\r
.reactions-add-button.reactions-hidden {\r
	display: none;\r
}\r
\r
.reactions-compact-reactions {\r
	display: none;\r
	gap: 2px;\r
}\r
\r
.reactions-compact-reactions.reactions-has-active {\r
	display: flex;\r
}\r
\r
.reactions-compact-option {\r
	display: none;\r
	align-items: center;\r
	justify-content: center;\r
	gap: 2px;\r
	padding: 2px 6px;\r
	border-radius: 10px;\r
	cursor: pointer;\r
	user-select: none;\r
	transition: background-color 0.2s ease;\r
	background-color: rgba(0, 0, 0, 0.05);\r
	font-size: 14px;\r
}\r
\r
.reactions-compact-option.reactions-active {\r
	display: flex;\r
}\r
\r
.reactions-compact-option:hover {\r
	background-color: rgba(34, 197, 94, 0.1);\r
}\r
\r
.reactions-compact-option.reactions-user-choice {\r
	background-color: rgba(34, 197, 94, 0.2);\r
}\r
\r
.reactions-compact-option-count {\r
	font-size: 12px;\r
	font-weight: 500;\r
}\r
\r
/* Expanded view styles */\r
.reactions-expanded-view {\r
	position: absolute;\r
	bottom: 4px;\r
	right: 4px;\r
	background: white;\r
	border: 1px solid #e5e5e5;\r
	border-radius: 8px;\r
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\r
	z-index: 1000;\r
	opacity: 0;\r
	transform: translateY(8px) scale(0.95);\r
	pointer-events: none;\r
	transition:\r
		opacity 0.2s ease,\r
		transform 0.2s ease;\r
}\r
\r
/* Transitions on post hover with slight delay to prevent flickering */\r
.post-normal:hover .reactions-expanded-view {\r
	opacity: 1;\r
	transform: translateY(0) scale(1);\r
	pointer-events: auto;\r
	transition-delay: 0.1s;\r
}\r
\r
.post-normal:hover .reactions-compact-view {\r
	opacity: 0;\r
	transition-delay: 0.05s;\r
}\r
\r
.reactions-reactions-options {\r
	display: flex;\r
	padding: 4px;\r
	gap: 2px;\r
}\r
.reactions-reactions-option {\r
	display: flex;\r
	align-items: center;\r
	justify-content: center;\r
	gap: 4px;\r
	padding: 6px 8px;\r
	border-radius: 6px;\r
	cursor: pointer;\r
	user-select: none;\r
	transition:\r
		background-color 0.3s,\r
		color 0.3s;\r
}\r
\r
.reactions-reactions-option:hover {\r
	background-color: rgba(34, 197, 94, 0.1);\r
}\r
.reactions-reactions-option.reactions-user-choice {\r
	background-color: rgba(34, 197, 94, 0.35);\r
}\r
.reactions-reactions-option-count[data-count="0"] {\r
	display: none;\r
}\r
`;var b0={votes:!0,reactions:!0,selectors:{post:".post-normal",reactionsContainer:"td:has(>.postcolor)"},pidFn:({reactionsContainer:b})=>`${b.id}`.split("_")[1]||"",server:"https://jcink-reactions.nicket.dev",performance:{debounceMs:300,cacheEnabled:!0,cacheTTL:300000,maxRetries:3,retryDelay:1000,retryBackoff:"exponential"},ui:{optimisticUpdates:!0,showLoadingStates:!0,animationDuration:200,showErrorNotifications:!0,notificationDuration:5000,accessibility:{announceChanges:!0,keyboardNavigation:!0}},customization:{reactionIcons:{heart:"❤️",laugh:"\uD83D\uDE02",clap:"\uD83D\uDC4F",thinking:"\uD83E\uDD14",sad:"\uD83D\uDE22",angry:"\uD83D\uDE20",confused:"\uD83D\uDE15",thumbsup:"\uD83D\uDC4D",thumbsdown:"\uD83D\uDC4E"},cssClasses:{userChoice:"reactions-user-choice",loading:"reactions-loading",disabled:"reactions-disabled"},labels:{vote:{like:"Like this post",dislike:"Dislike this post"},reactions:{heart:"Love",laugh:"Funny",clap:"Applause",thinking:"Thoughtful",sad:"Sad",angry:"Angry",confused:"Confused",thumbsup:"Thumbs up",thumbsdown:"Thumbs down"}}},hooks:{}};function f(b={}){let x=I(b0,b);return x0(x),x}function I(b,x){let j={...b};for(let Y in x)if(x[Y]&&typeof x[Y]==="object"&&!Array.isArray(x[Y]))j[Y]=I(b[Y]||{},x[Y]);else j[Y]=x[Y];return j}function x0(b){if(!b.server||typeof b.server!=="string")throw new Error("Server URL is required and must be a string");try{new URL(b.server)}catch{throw new Error("Server URL must be a valid URL")}if(!b.selectors.post||!b.selectors.reactionsContainer)throw new Error("Post and reactions container selectors are required");if(b.performance.debounceMs<0)throw new Error("Debounce delay must be non-negative");if(b.performance.maxRetries<1)throw new Error("Max retries must be at least 1");if(b.performance.retryDelay<0)throw new Error("Retry delay must be non-negative");if(b.ui.animationDuration<0)throw new Error("Animation duration must be non-negative");if(b.ui.notificationDuration<0)throw new Error("Notification duration must be non-negative");if(b.reactions&&Object.keys(b.customization.reactionIcons).length===0)throw new Error("At least one reaction icon must be defined when reactions are enabled")}class k extends Error{status;isRetryable;constructor(b,x,j=!0){super(b);this.status=x;this.isRetryable=j;this.name="NetworkError"}}class B extends Error{constructor(b="Authentication required"){super(b);this.name="AuthenticationError"}}async function V(b,x){let j;for(let Y=1;Y<=x.maxAttempts;Y++)try{return await b()}catch(z){if(j=z,z instanceof B)throw z;if(z instanceof k&&!z.isRetryable)throw z;if(Y===x.maxAttempts)throw j;let Q=x.delay;if(x.backoff==="exponential")Q=x.delay*Math.pow(2,Y-1);else if(x.backoff==="linear")Q=x.delay*Y;await new Promise((K)=>setTimeout(K,Q))}throw j}class L{static instance;container=null;static getInstance(){if(!L.instance)L.instance=new L;return L.instance}createContainer(){if(this.container)return this.container;return this.container=document.createElement("div"),this.container.id="reactions-error-container",this.container.style.cssText=`
			position: fixed;
			top: 20px;
			right: 20px;
			z-index: 10000;
			max-width: 400px;
		`,document.body.appendChild(this.container),this.container}show(b,x="error",j=5000){let Y=this.createContainer(),z=document.createElement("div");z.style.cssText=`
			background: ${x==="error"?"#f56565":x==="warning"?"#ed8936":"#4299e1"};
			color: white;
			padding: 12px 16px;
			margin-bottom: 8px;
			border-radius: 4px;
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			opacity: 0;
			transform: translateX(100%);
			transition: all 0.3s ease;
		`,z.textContent=b,Y.appendChild(z),requestAnimationFrame(()=>{z.style.opacity="1",z.style.transform="translateX(0)"}),setTimeout(()=>{z.style.opacity="0",z.style.transform="translateX(100%)",setTimeout(()=>{if(z.parentNode)z.parentNode.removeChild(z)},300)},j)}showError(b){let x="An unexpected error occurred";if(b instanceof B)x="Please log in to vote or react to posts";else if(b instanceof k)x=b.status===429?"Too many requests. Please wait a moment.":"Network error. Please check your connection.";this.show(x,"error")}}class N{config;topicId;errorNotifier=L.getInstance();constructor(b,x){this.config=b,this.topicId=x}async get(b,x){let j=new URLSearchParams(x?.query);return j.set("forumUrl",location.origin),j.set("topicId",this.topicId),V(async()=>{let Y=await fetch(`${this.config.server}${b}?${j}`,{headers:{"Content-Type":"application/json"}});if(!Y.ok)throw new k(`GET ${b} failed`,Y.status,Y.status>=500||Y.status===429);return Y},{maxAttempts:this.config.performance.maxRetries,delay:this.config.performance.retryDelay,backoff:this.config.performance.retryBackoff})}async put(b,x){return V(async()=>{try{let j=await authcinkPromise.then((z)=>z.authenticate()),Y=await fetch(`${this.config.server}${b}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${j}`},body:JSON.stringify(x)});if(!Y.ok){if(Y.status===401||Y.status===403)throw new B;throw new k(`PUT ${b} failed`,Y.status,Y.status>=500||Y.status===429)}return Y}catch(j){if(j instanceof k||j instanceof B)throw j;throw new B("Authentication failed")}},{maxAttempts:this.config.performance.maxRetries,delay:this.config.performance.retryDelay,backoff:this.config.performance.retryBackoff})}}function v(){let b=document.getElementById("logged-in-as");if(!b?.href)return null;let j=new URL(b.href).searchParams.get("showuser");return j?{userId:parseInt(j)}:null}function C(b){let x=document.createElement("style");x.textContent=b,document.head.appendChild(x)}function q(b,x){if(!b)return;b.textContent=x.toString(),b.setAttribute("data-count",x.toString())}function G(b){if(!b)return 0;return parseInt(b.getAttribute("data-count")||"0")}function F(b,x,j){if(j)b.classList.add(x);else b.classList.remove(x)}function P(b,x){b.forEach((j)=>j.classList.remove(x))}class O{updates=new Map;applyVoteUpdate(b,x,j,Y,z){let Q=`vote-${x}-${Date.now()}`,K=b.upvote?.classList.contains("reactions-user-choice")||!1,Z=b.downvote?.classList.contains("reactions-user-choice")||!1,X=b.upvote?G(b.upvote.querySelector(".reactions-votes-count")):0,_=b.downvote?G(b.downvote.querySelector(".reactions-votes-count")):0;if(j==="like"){if(b.upvote){F(b.upvote,"reactions-user-choice",!Y);let W=X,$=_;if(z==="dislike"&&!Y){if($=Math.max(0,_-1),W=X+1,b.downvote)q(b.downvote.querySelector(".reactions-votes-count"),$)}else W=Y?Math.max(0,X-1):X+1;q(b.upvote.querySelector(".reactions-votes-count"),W)}if(b.downvote)b.downvote.classList.remove("reactions-user-choice")}else{if(b.downvote){F(b.downvote,"reactions-user-choice",!Y);let W=X,$=_;if(z==="like"&&!Y){if(W=Math.max(0,X-1),$=_+1,b.upvote)q(b.upvote.querySelector(".reactions-votes-count"),W)}else $=Y?Math.max(0,_-1):_+1;q(b.downvote.querySelector(".reactions-votes-count"),$)}if(b.upvote)b.upvote.classList.remove("reactions-user-choice")}let J=()=>{if(b.upvote)F(b.upvote,"reactions-user-choice",K),q(b.upvote.querySelector(".reactions-votes-count"),X);if(b.downvote)F(b.downvote,"reactions-user-choice",Z),q(b.downvote.querySelector(".reactions-votes-count"),_)};return this.updates.set(Q,{id:Q,type:"vote",postId:x,rollback:J}),Q}applyReactionUpdate(b,x,j,Y,z){let Q=`reaction-${x}-${Date.now()}`;if(!b.reactions)return Q;let K=b.reactions.querySelectorAll(".reactions-reactions-option"),Z=Array.from(K).map((J)=>({element:J,active:J.classList.contains("reactions-user-choice"),count:G(J.querySelector(".reactions-reactions-option-count"))})),X=Array.from(K).find((J)=>J.getAttribute("aria-label")===j);if(X){if(P(K,"reactions-user-choice"),!Y)X.classList.add("reactions-user-choice");if(z&&z!==j){let J=Array.from(K).find((H)=>H.getAttribute("aria-label")===z);if(J){let H=J.querySelector(".reactions-reactions-option-count"),S=G(H);q(H,Math.max(0,S-1))}let W=X.querySelector(".reactions-reactions-option-count"),$=G(W);q(W,$+1)}else{let J=X.querySelector(".reactions-reactions-option-count"),W=G(J),$=Y?Math.max(0,W-1):W+1;q(J,$)}}let _=()=>{Z.forEach(({element:J,active:W,count:$})=>{F(J,"reactions-user-choice",W),q(J.querySelector(".reactions-reactions-option-count"),$)})};return this.updates.set(Q,{id:Q,type:"reaction",postId:x,rollback:_}),Q}commit(b){this.updates.delete(b)}rollback(b){let x=this.updates.get(b);if(x)x.rollback(),this.updates.delete(b)}rollbackPost(b){Array.from(this.updates.values()).filter((j)=>j.postId===b).forEach((j)=>{j.rollback(),this.updates.delete(j.id)})}clear(){this.updates.clear()}}class w{userChoices;loadingStates;optimisticManager;constructor(){this.userChoices={votes:new Map,reactions:new Map},this.loadingStates={votes:new Set,reactions:new Set},this.optimisticManager=new O}setUserVote(b,x){this.userChoices.votes.set(b,x)}getUserVote(b){return this.userChoices.votes.get(b)||null}setUserReaction(b,x){this.userChoices.reactions.set(b,x)}getUserReaction(b){return this.userChoices.reactions.get(b)||null}isVoteLoading(b){return this.loadingStates.votes.has(b)}setVoteLoading(b,x){if(x)this.loadingStates.votes.add(b);else this.loadingStates.votes.delete(b)}isReactionLoading(b){return this.loadingStates.reactions.has(b)}setReactionLoading(b,x){if(x)this.loadingStates.reactions.add(b);else this.loadingStates.reactions.delete(b)}applyOptimisticVote(b,x,j,Y){let z=this.getUserVote(x),Q=this.optimisticManager.applyVoteUpdate(b,x,j,Y,z);return{updateId:Q,commit:()=>this.optimisticManager.commit(Q),rollback:()=>this.optimisticManager.rollback(Q)}}applyOptimisticReaction(b,x,j,Y){let z=this.getUserReaction(x),Q=this.optimisticManager.applyReactionUpdate(b,x,j,Y,z);return{updateId:Q,commit:()=>this.optimisticManager.commit(Q),rollback:()=>this.optimisticManager.rollback(Q)}}rollbackPost(b){this.optimisticManager.rollbackPost(b)}}function g(b,x){let j=null;return(...Y)=>{if(j)clearTimeout(j);j=setTimeout(()=>{b(...Y),j=null},x)}}function d(b,x){let j=Object.assign(document.createElement("div"),{className:"reactions-votes"}),Y=null,z=null;if(b.votes){if(Y=Object.assign(document.createElement("div"),{className:"reactions-votes-button reactions-votes-button-upvote",innerHTML:`
				<div class="reactions-votes-icon">\uD83D\uDC4D</div>
				<div class="reactions-votes-count" data-count="0">0</div>
			`}),j.appendChild(Y),b.votes===!0)z=Object.assign(document.createElement("div"),{className:"reactions-votes-button reactions-votes-button-downvote",innerHTML:`
					<div class="reactions-votes-icon">\uD83D\uDC4E</div>
					<div class="reactions-votes-count" data-count="0">0</div>
				`}),j.appendChild(z);x.appendChild(j)}return{votes:j,upvote:Y,downvote:z}}function j0(b,x,j,Y){if(x==="like"){if(F(b.upvote,"reactions-user-choice",!j),b.downvote)b.downvote.classList.remove("reactions-user-choice");if(Y==="dislike"&&!j){if(b.downvote){let K=b.downvote.querySelector(".reactions-votes-count"),Z=G(K);q(K,Math.max(0,Z-1))}let z=b.upvote.querySelector(".reactions-votes-count"),Q=G(z);q(z,Q+1)}else{let z=b.upvote.querySelector(".reactions-votes-count"),Q=G(z),K=j?Math.max(0,Q-1):Q+1;q(z,K)}}else{if(F(b.downvote,"reactions-user-choice",!j),b.upvote)b.upvote.classList.remove("reactions-user-choice");if(Y==="like"&&!j){if(b.upvote){let K=b.upvote.querySelector(".reactions-votes-count"),Z=G(K);q(K,Math.max(0,Z-1))}let z=b.downvote.querySelector(".reactions-votes-count"),Q=G(z);q(z,Q+1)}else{let z=b.downvote.querySelector(".reactions-votes-count"),Q=G(z),K=j?Math.max(0,Q-1):Q+1;q(z,K)}}}function c(b,x,j,Y,z,Q){let K=L.getInstance(),Z=g(async(X)=>{if(z.isVoteLoading(x))return;z.setVoteLoading(x,!0);let _=X==="like"?b.upvote.classList.contains("reactions-user-choice"):b.downvote.classList.contains("reactions-user-choice"),J=z.getUserVote(x),W=null;if(Q.ui.optimisticUpdates)W=z.applyOptimisticVote(b,x,X,_);try{let $=await Y.put(`/topics/${j}/posts/${x}/vote`,{type:_?null:X});if($.ok){let H=_?null:X;if(z.setUserVote(x,H),W)W.commit();else j0(b,X,_,J)}else throw new Error(`Vote request failed with status ${$.status}`)}catch($){if(W)W.rollback();if(Q.ui.showErrorNotifications)K.showError($);console.error("Failed to vote:",$)}finally{z.setVoteLoading(x,!1)}},Q.performance.debounceMs);if(b.upvote)b.upvote.addEventListener("click",(X)=>{X.preventDefault(),X.stopPropagation(),Z("like")});if(b.downvote)b.downvote.addEventListener("click",(X)=>{X.preventDefault(),X.stopPropagation(),Z("dislike")})}function l(b,x,j,Y){let z=new Map,Q=new Map;b.forEach((K)=>{let Z=K.postId.toString(),X=K.voteType;if(!z.has(Z))z.set(Z,{like:0,dislike:0});let _=z.get(Z);if(_[X]=(_[X]||0)+1,j&&K.userId===j.userId)Q.set(Z,X),Y.setUserVote(Z,X)}),x.forEach((K,Z)=>{let X=z.get(Z)||{like:0,dislike:0},_=Q.get(Z);if(K.upvote){let J=K.upvote.querySelector(".reactions-votes-count");q(J,X.like),F(K.upvote,"reactions-user-choice",_==="like")}if(K.downvote){let J=K.downvote.querySelector(".reactions-votes-count");q(J,X.dislike),F(K.downvote,"reactions-user-choice",_==="dislike")}})}function u(b,x){if(!b.reactions)return null;let j=Object.assign(document.createElement("div"),{className:"reactions-reactions"}),Y=Object.assign(document.createElement("div"),{className:"reactions-compact-view"}),z=Object.assign(document.createElement("div"),{className:"reactions-add-button",innerHTML:'<div class="reactions-add-button-icon">\uD83D\uDE0A</div>',title:"Add reaction"});z.setAttribute("role","button"),z.setAttribute("tabindex","0");let Q=Object.assign(document.createElement("div"),{className:"reactions-compact-reactions"});Y.appendChild(z),Y.appendChild(Q);let K=Object.assign(document.createElement("div"),{className:"reactions-expanded-view"}),Z=Object.assign(document.createElement("div"),{className:"reactions-reactions-options"});return Object.entries(b.customization.reactionIcons).forEach(([X,_])=>{let J=document.createElement("div");J.className="reactions-reactions-option",J.innerHTML=`<div class="reactions-reactions-option-icon">${_}</div>
			<div class="reactions-reactions-option-count" data-count="0">0</div>`,J.setAttribute("aria-label",X),J.setAttribute("role","button"),J.setAttribute("tabindex","0"),Z.appendChild(J);let W=document.createElement("div");W.className="reactions-compact-option",W.innerHTML=`<div class="reactions-compact-option-icon">${_}</div>
			<div class="reactions-compact-option-count" data-count="0">0</div>`,W.setAttribute("aria-label",X),W.setAttribute("role","button"),W.setAttribute("tabindex","0"),Q.appendChild(W)}),K.appendChild(Z),j.appendChild(Y),j.appendChild(K),x.appendChild(j),j}function m(b,x,j,Y,z,Q){if(!b.reactions)return;let K=b.reactions.querySelectorAll(".reactions-reactions-option"),Z=b.reactions.querySelectorAll(".reactions-compact-option"),X=b.reactions.querySelector(".reactions-add-button");[...Array.from(K),...Array.from(Z)].forEach((J)=>{J.addEventListener("click",async(W)=>{if(W.preventDefault(),W.stopPropagation(),z.isReactionLoading(x))return;z.setReactionLoading(x,!0);try{let $=J.getAttribute("aria-label"),H=J.classList.contains("reactions-user-choice"),S=z.getUserReaction(x);if((await Y.put(`/topics/${j}/posts/${x}/reaction`,{reaction:H?null:$})).ok){let a=H?null:$;if(z.setUserReaction(x,a),P([...Array.from(K),...Array.from(Z)],"reactions-user-choice"),!H){let U=Array.from(K).find((T)=>T.getAttribute("aria-label")===$),y=Array.from(Z).find((T)=>T.getAttribute("aria-label")===$);if(U)U.classList.add("reactions-user-choice");if(y)y.classList.add("reactions-user-choice")}if(S&&S!==$)A(K,Z,S,-1),A(K,Z,$,1);else if(S===$)A(K,Z,$,-1);else if(!S)A(K,Z,$,1);if(b.reactions)r(b.reactions)}}catch($){console.error("Failed to react:",$)}finally{z.setReactionLoading(x,!1)}})})}function A(b,x,j,Y){let z=(Z)=>{let X=Z.querySelector(".reactions-reactions-option-count, .reactions-compact-option-count");if(X){let _=G(X),J=Math.max(0,_+Y);q(X,J)}},Q=Array.from(b).find((Z)=>Z.getAttribute("aria-label")===j);if(Q)z(Q);let K=Array.from(x).find((Z)=>Z.getAttribute("aria-label")===j);if(K)z(K)}function r(b){let x=b.querySelector(".reactions-add-button"),j=b.querySelector(".reactions-compact-reactions"),Y=b.querySelectorAll(".reactions-compact-option"),z=!1;if(Y.forEach((Q)=>{let K=Q.querySelector(".reactions-compact-option-count");if(G(K)>0)Q.classList.add("reactions-active"),z=!0;else Q.classList.remove("reactions-active")}),z)x.classList.add("reactions-hidden"),j.classList.add("reactions-has-active");else x.classList.remove("reactions-hidden"),j.classList.remove("reactions-has-active")}function p(b,x,j,Y){let z=new Map,Q=new Map;b.forEach((K)=>{let Z=K.postId.toString(),X=K.reaction;if(!z.has(Z))z.set(Z,new Map);let _=z.get(Z);if(_.set(X,(_.get(X)||0)+1),j&&K.userId===j.userId)Q.set(Z,X),Y.setUserReaction(Z,X)}),x.forEach((K,Z)=>{if(!K.reactions)return;let X=z.get(Z)||new Map,_=Q.get(Z),J=K.reactions.querySelectorAll(".reactions-reactions-option"),W=K.reactions.querySelectorAll(".reactions-compact-option");J.forEach(($)=>{let H=$.getAttribute("aria-label"),S=X.get(H)||0,h=$.querySelector(".reactions-reactions-option-count");q(h,S),F($,"reactions-user-choice",_===H)}),W.forEach(($)=>{let H=$.getAttribute("aria-label"),S=X.get(H)||0,h=$.querySelector(".reactions-compact-option-count");q(h,S),F($,"reactions-user-choice",_===H)}),r(K.reactions)})}function z0(){let b=new URL(location.href);return b.searchParams.get("showtopic")||(b.searchParams.get("act")==="ST"?b.searchParams.get("t"):null)}function Y0(b,x,j,Y,z,Q){let K=b.querySelector(x.selectors.reactionsContainer);if(!K)return null;K.style.position="relative";let{votes:Z,upvote:X,downvote:_}=d(x,K),J=u(x,K),W={post:b,reactionsContainer:K,votes:Z,upvote:X,downvote:_,reactions:J||void 0},$=x.pidFn(W);return j.set($,W),c(W,$,Y,z,Q,x),m(W,$,Y,z,Q,x),$}async function K0(b,x,j,Y,z){try{let K=await(await b.get("/reactions",{query:{postIds:x.join(",")}})).json();p(K,j,Y,z)}catch(Q){console.error("Failed to load reactions:",Q),L.getInstance().showError(Q)}}async function Q0(b,x,j,Y,z){try{let K=await(await b.get("/votes",{query:{postIds:x.join(",")}})).json();l(K,j,Y,z)}catch(Q){console.error("Failed to load votes:",Q),L.getInstance().showError(Q)}}async function M(b){let x=z0();if(!x)return;let j=f(b),Y=v();C(R);let z=new N(j,x),Q=new w,K=new Map,Z=document.querySelectorAll(j.selectors.post),X=[];if(Z.forEach((J)=>{let W=Y0(J,j,K,x,z,Q);if(W)X.push(W)}),X.length===0)return;let _=[];if(j.reactions)_.push(K0(z,X,K,Y,Q));if(j.votes)_.push(Q0(z,X,K,Y,Q));await Promise.allSettled(_)}window.Reactions=M;})();
