(()=>{var{defineProperty:M,getOwnPropertyNames:s,getOwnPropertyDescriptor:i}=Object,n=Object.prototype.hasOwnProperty;var y=new WeakMap,o=(b)=>{var x=y.get(b),j;if(x)return x;if(x=M({},"__esModule",{value:!0}),b&&typeof b==="object"||typeof b==="function")s(b).map((K)=>!n.call(x,K)&&M(x,K,{get:()=>b[K],enumerable:!(j=i(b,K))||j.enumerable}));return y.set(b,x),x};var t=(b,x)=>{for(var j in x)M(b,j,{get:x[j],enumerable:!0,configurable:!0,set:(K)=>x[j]=()=>K})};var z0={};t(z0,{default:()=>E});var R=`.reactions-votes {
	position: absolute;
	top: 0;
	right: 0;
	display: flex;
	flex-direction: column;
	align-items: center;
	justify-content: center;
	gap: 4px;
	font-size: 20px;
}
.reactions-votes-button {
	display: flex;
	align-items: center;
	justify-content: center;
	gap: 4px;
	padding: 4px;
	border-radius: 4px;
	cursor: pointer;
	user-select: none;
	transition:
		background-color 0.3s,
		color 0.3s;
	background-color: transparent;
	color: #000;
}
.reactions-votes-button-upvote:hover {
	background-color: rgba(34, 197, 94, 0.1);
}
.reactions-votes-button-downvote:hover {
	background-color: rgba(239, 68, 68, 0.1);
}
.reactions-votes-button-downvote.reactions-user-choice {
	background-color: rgba(239, 68, 68, 0.15);
}
.reactions-votes-button-upvote.reactions-user-choice {
	background-color: rgba(34, 197, 94, 0.15);
}

.reactions-reactions {
	position: absolute;
	bottom: 0;
	right: 0;
	font-size: 16px;
}

/* Compact view styles */
.reactions-compact-view {
	display: flex;
	align-items: center;
	gap: 4px;
}

.reactions-add-button {
	display: flex;
	align-items: center;
	justify-content: center;
	padding: 4px 8px;
	border-radius: 12px;
	cursor: pointer;
	user-select: none;
	transition: background-color 0.2s ease;
	background-color: rgba(0, 0, 0, 0.05);
	font-size: 18px;
}

.reactions-add-button:hover {
	background-color: rgba(0, 0, 0, 0.1);
}

.reactions-compact-reactions {
	display: none;
	gap: 2px;
}

.reactions-compact-option {
	display: flex;
	align-items: center;
	justify-content: center;
	gap: 2px;
	padding: 2px 6px;
	border-radius: 10px;
	cursor: pointer;
	user-select: none;
	transition: background-color 0.2s ease;
	background-color: rgba(0, 0, 0, 0.05);
	font-size: 14px;
}

.reactions-compact-option:hover {
	background-color: rgba(34, 197, 94, 0.1);
}

.reactions-compact-option.reactions-user-choice {
	background-color: rgba(34, 197, 94, 0.2);
}

.reactions-compact-option-count {
	font-size: 12px;
	font-weight: 500;
}

/* Expanded view styles */
.reactions-expanded-view {
	display: none;
	position: absolute;
	bottom: 0;
	right: 0;
	background: white;
	border: 1px solid #e5e5e5;
	border-radius: 8px;
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
	z-index: 1000;
}

.reactions-reactions.reactions-expanded .reactions-compact-view {
	display: none;
}

.reactions-reactions.reactions-expanded .reactions-expanded-view {
	display: block;
}

.reactions-reactions-options {
	display: flex;
	padding: 4px;
	gap: 2px;
}
.reactions-reactions-option {
	display: flex;
	align-items: center;
	justify-content: center;
	gap: 4px;
	padding: 6px 8px;
	border-radius: 6px;
	cursor: pointer;
	user-select: none;
	transition:
		background-color 0.3s,
		color 0.3s;
}

.reactions-reactions-option:hover {
	background-color: rgba(34, 197, 94, 0.1);
}
.reactions-reactions-option.reactions-user-choice {
	background-color: rgba(34, 197, 94, 0.35);
}
.reactions-reactions-option-count[data-count="0"] {
	display: none;
}
`;var b0={votes:!0,reactions:!0,selectors:{post:".post-normal",reactionsContainer:"td:has(>.postcolor)"},pidFn:({reactionsContainer:b})=>`${b.id}`.split("_")[1]||"",server:"https://jcink-reactions.nicket.dev",performance:{debounceMs:300,cacheEnabled:!0,cacheTTL:300000,maxRetries:3,retryDelay:1000,retryBackoff:"exponential"},ui:{optimisticUpdates:!0,showLoadingStates:!0,animationDuration:200,showErrorNotifications:!0,notificationDuration:5000,accessibility:{announceChanges:!0,keyboardNavigation:!0}},customization:{reactionIcons:{heart:"❤️",laugh:"\uD83D\uDE02",clap:"\uD83D\uDC4F",thinking:"\uD83E\uDD14",sad:"\uD83D\uDE22",angry:"\uD83D\uDE20",confused:"\uD83D\uDE15",thumbsup:"\uD83D\uDC4D",thumbsdown:"\uD83D\uDC4E"},cssClasses:{userChoice:"reactions-user-choice",loading:"reactions-loading",disabled:"reactions-disabled"},labels:{vote:{like:"Like this post",dislike:"Dislike this post"},reactions:{heart:"Love",laugh:"Funny",clap:"Applause",thinking:"Thoughtful",sad:"Sad",angry:"Angry",confused:"Confused",thumbsup:"Thumbs up",thumbsdown:"Thumbs down"}}},hooks:{}};function f(b={}){let x=v(b0,b);return x0(x),x}function v(b,x){let j={...b};for(let K in x)if(x[K]&&typeof x[K]==="object"&&!Array.isArray(x[K]))j[K]=v(b[K]||{},x[K]);else j[K]=x[K];return j}function x0(b){if(!b.server||typeof b.server!=="string")throw new Error("Server URL is required and must be a string");try{new URL(b.server)}catch{throw new Error("Server URL must be a valid URL")}if(!b.selectors.post||!b.selectors.reactionsContainer)throw new Error("Post and reactions container selectors are required");if(b.performance.debounceMs<0)throw new Error("Debounce delay must be non-negative");if(b.performance.maxRetries<1)throw new Error("Max retries must be at least 1");if(b.performance.retryDelay<0)throw new Error("Retry delay must be non-negative");if(b.ui.animationDuration<0)throw new Error("Animation duration must be non-negative");if(b.ui.notificationDuration<0)throw new Error("Notification duration must be non-negative");if(b.reactions&&Object.keys(b.customization.reactionIcons).length===0)throw new Error("At least one reaction icon must be defined when reactions are enabled")}class k extends Error{status;isRetryable;constructor(b,x,j=!0){super(b);this.status=x;this.isRetryable=j;this.name="NetworkError"}}class P extends Error{constructor(b="Authentication required"){super(b);this.name="AuthenticationError"}}async function N(b,x){let j;for(let K=1;K<=x.maxAttempts;K++)try{return await b()}catch(z){if(j=z,z instanceof P)throw z;if(z instanceof k&&!z.isRetryable)throw z;if(K===x.maxAttempts)throw j;let X=x.delay;if(x.backoff==="exponential")X=x.delay*Math.pow(2,K-1);else if(x.backoff==="linear")X=x.delay*K;await new Promise((Q)=>setTimeout(Q,X))}throw j}class S{static instance;container=null;static getInstance(){if(!S.instance)S.instance=new S;return S.instance}createContainer(){if(this.container)return this.container;return this.container=document.createElement("div"),this.container.id="reactions-error-container",this.container.style.cssText=`
			position: fixed;
			top: 20px;
			right: 20px;
			z-index: 10000;
			max-width: 400px;
		`,document.body.appendChild(this.container),this.container}show(b,x="error",j=5000){let K=this.createContainer(),z=document.createElement("div");z.style.cssText=`
			background: ${x==="error"?"#f56565":x==="warning"?"#ed8936":"#4299e1"};
			color: white;
			padding: 12px 16px;
			margin-bottom: 8px;
			border-radius: 4px;
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			opacity: 0;
			transform: translateX(100%);
			transition: all 0.3s ease;
		`,z.textContent=b,K.appendChild(z),requestAnimationFrame(()=>{z.style.opacity="1",z.style.transform="translateX(0)"}),setTimeout(()=>{z.style.opacity="0",z.style.transform="translateX(100%)",setTimeout(()=>{if(z.parentNode)z.parentNode.removeChild(z)},300)},j)}showError(b){let x="An unexpected error occurred";if(b instanceof P)x="Please log in to vote or react to posts";else if(b instanceof k)x=b.status===429?"Too many requests. Please wait a moment.":"Network error. Please check your connection.";this.show(x,"error")}}class O{config;topicId;errorNotifier=S.getInstance();constructor(b,x){this.config=b,this.topicId=x}async get(b,x){let j=new URLSearchParams(x?.query);return j.set("forumUrl",location.origin),j.set("topicId",this.topicId),console.log({server:this.config.server,path:b,query:`${j}`}),N(async()=>{let K=await fetch(`${this.config.server}${b}?${j}`,{headers:{"Content-Type":"application/json"}});if(!K.ok)throw new k(`GET ${b} failed`,K.status,K.status>=500||K.status===429);return K},{maxAttempts:this.config.performance.maxRetries,delay:this.config.performance.retryDelay,backoff:this.config.performance.retryBackoff})}async put(b,x){return N(async()=>{try{let j=await authcinkPromise.then((z)=>z.authenticate()),K=await fetch(`${this.config.server}${b}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${j}`},body:JSON.stringify(x)});if(!K.ok){if(K.status===401||K.status===403)throw new P;throw new k(`PUT ${b} failed`,K.status,K.status>=500||K.status===429)}return K}catch(j){if(j instanceof k||j instanceof P)throw j;throw new P("Authentication failed")}},{maxAttempts:this.config.performance.maxRetries,delay:this.config.performance.retryDelay,backoff:this.config.performance.retryBackoff})}}function C(){let b=document.getElementById("logged-in-as");if(!b?.href)return null;let j=new URL(b.href).searchParams.get("showuser");return j?{userId:parseInt(j)}:null}function g(b){let x=document.createElement("style");x.textContent=b,document.head.appendChild(x)}function q(b,x){if(!b)return;b.textContent=x.toString(),b.setAttribute("data-count",x.toString())}function H(b){if(!b)return 0;return parseInt(b.getAttribute("data-count")||"0")}function F(b,x,j){if(j)b.classList.add(x);else b.classList.remove(x)}function D(b,x){b.forEach((j)=>j.classList.remove(x))}class w{updates=new Map;applyVoteUpdate(b,x,j,K,z){let X=`vote-${x}-${Date.now()}`,Q=b.upvote?.classList.contains("reactions-user-choice")||!1,Y=b.downvote?.classList.contains("reactions-user-choice")||!1,Z=b.upvote?H(b.upvote.querySelector(".reactions-votes-count")):0,_=b.downvote?H(b.downvote.querySelector(".reactions-votes-count")):0;if(j==="like"){if(b.upvote){F(b.upvote,"reactions-user-choice",!K);let W=Z,$=_;if(z==="dislike"&&!K){if($=Math.max(0,_-1),W=Z+1,b.downvote)q(b.downvote.querySelector(".reactions-votes-count"),$)}else W=K?Math.max(0,Z-1):Z+1;q(b.upvote.querySelector(".reactions-votes-count"),W)}if(b.downvote)b.downvote.classList.remove("reactions-user-choice")}else{if(b.downvote){F(b.downvote,"reactions-user-choice",!K);let W=Z,$=_;if(z==="like"&&!K){if(W=Math.max(0,Z-1),$=_+1,b.upvote)q(b.upvote.querySelector(".reactions-votes-count"),W)}else $=K?Math.max(0,_-1):_+1;q(b.downvote.querySelector(".reactions-votes-count"),$)}if(b.upvote)b.upvote.classList.remove("reactions-user-choice")}let J=()=>{if(b.upvote)F(b.upvote,"reactions-user-choice",Q),q(b.upvote.querySelector(".reactions-votes-count"),Z);if(b.downvote)F(b.downvote,"reactions-user-choice",Y),q(b.downvote.querySelector(".reactions-votes-count"),_)};return this.updates.set(X,{id:X,type:"vote",postId:x,rollback:J}),X}applyReactionUpdate(b,x,j,K,z){let X=`reaction-${x}-${Date.now()}`;if(!b.reactions)return X;let Q=b.reactions.querySelectorAll(".reactions-reactions-option"),Y=Array.from(Q).map((J)=>({element:J,active:J.classList.contains("reactions-user-choice"),count:H(J.querySelector(".reactions-reactions-option-count"))})),Z=Array.from(Q).find((J)=>J.getAttribute("aria-label")===j);if(Z){if(D(Q,"reactions-user-choice"),!K)Z.classList.add("reactions-user-choice");if(z&&z!==j){let J=Array.from(Q).find((G)=>G.getAttribute("aria-label")===z);if(J){let G=J.querySelector(".reactions-reactions-option-count"),L=H(G);q(G,Math.max(0,L-1))}let W=Z.querySelector(".reactions-reactions-option-count"),$=H(W);q(W,$+1)}else{let J=Z.querySelector(".reactions-reactions-option-count"),W=H(J),$=K?Math.max(0,W-1):W+1;q(J,$)}}let _=()=>{Y.forEach(({element:J,active:W,count:$})=>{F(J,"reactions-user-choice",W),q(J.querySelector(".reactions-reactions-option-count"),$)})};return this.updates.set(X,{id:X,type:"reaction",postId:x,rollback:_}),X}commit(b){this.updates.delete(b)}rollback(b){let x=this.updates.get(b);if(x)x.rollback(),this.updates.delete(b)}rollbackPost(b){Array.from(this.updates.values()).filter((j)=>j.postId===b).forEach((j)=>{j.rollback(),this.updates.delete(j.id)})}clear(){this.updates.clear()}}class U{userChoices;loadingStates;optimisticManager;constructor(){this.userChoices={votes:new Map,reactions:new Map},this.loadingStates={votes:new Set,reactions:new Set},this.optimisticManager=new w}setUserVote(b,x){this.userChoices.votes.set(b,x)}getUserVote(b){return this.userChoices.votes.get(b)||null}setUserReaction(b,x){this.userChoices.reactions.set(b,x)}getUserReaction(b){return this.userChoices.reactions.get(b)||null}isVoteLoading(b){return this.loadingStates.votes.has(b)}setVoteLoading(b,x){if(x)this.loadingStates.votes.add(b);else this.loadingStates.votes.delete(b)}isReactionLoading(b){return this.loadingStates.reactions.has(b)}setReactionLoading(b,x){if(x)this.loadingStates.reactions.add(b);else this.loadingStates.reactions.delete(b)}applyOptimisticVote(b,x,j,K){let z=this.getUserVote(x),X=this.optimisticManager.applyVoteUpdate(b,x,j,K,z);return{updateId:X,commit:()=>this.optimisticManager.commit(X),rollback:()=>this.optimisticManager.rollback(X)}}applyOptimisticReaction(b,x,j,K){let z=this.getUserReaction(x),X=this.optimisticManager.applyReactionUpdate(b,x,j,K,z);return{updateId:X,commit:()=>this.optimisticManager.commit(X),rollback:()=>this.optimisticManager.rollback(X)}}rollbackPost(b){this.optimisticManager.rollbackPost(b)}}function d(b,x){let j=null;return(...K)=>{if(j)clearTimeout(j);j=setTimeout(()=>{b(...K),j=null},x)}}function c(b,x){let j=Object.assign(document.createElement("div"),{className:"reactions-votes"}),K=null,z=null;if(b.votes){if(K=Object.assign(document.createElement("div"),{className:"reactions-votes-button reactions-votes-button-upvote",innerHTML:`
				<div class="reactions-votes-icon">\uD83D\uDC4D</div>
				<div class="reactions-votes-count" data-count="0">0</div>
			`}),j.appendChild(K),b.votes===!0)z=Object.assign(document.createElement("div"),{className:"reactions-votes-button reactions-votes-button-downvote",innerHTML:`
					<div class="reactions-votes-icon">\uD83D\uDC4E</div>
					<div class="reactions-votes-count" data-count="0">0</div>
				`}),j.appendChild(z);x.appendChild(j)}return{votes:j,upvote:K,downvote:z}}function j0(b,x,j,K){if(x==="like"){if(F(b.upvote,"reactions-user-choice",!j),b.downvote)b.downvote.classList.remove("reactions-user-choice");if(K==="dislike"&&!j){if(b.downvote){let Q=b.downvote.querySelector(".reactions-votes-count"),Y=H(Q);q(Q,Math.max(0,Y-1))}let z=b.upvote.querySelector(".reactions-votes-count"),X=H(z);q(z,X+1)}else{let z=b.upvote.querySelector(".reactions-votes-count"),X=H(z),Q=j?Math.max(0,X-1):X+1;q(z,Q)}}else{if(F(b.downvote,"reactions-user-choice",!j),b.upvote)b.upvote.classList.remove("reactions-user-choice");if(K==="like"&&!j){if(b.upvote){let Q=b.upvote.querySelector(".reactions-votes-count"),Y=H(Q);q(Q,Math.max(0,Y-1))}let z=b.downvote.querySelector(".reactions-votes-count"),X=H(z);q(z,X+1)}else{let z=b.downvote.querySelector(".reactions-votes-count"),X=H(z),Q=j?Math.max(0,X-1):X+1;q(z,Q)}}}function l(b,x,j,K,z,X){let Q=S.getInstance(),Y=d(async(Z)=>{if(z.isVoteLoading(x))return;z.setVoteLoading(x,!0);let _=Z==="like"?b.upvote.classList.contains("reactions-user-choice"):b.downvote.classList.contains("reactions-user-choice"),J=z.getUserVote(x),W=null;if(X.ui.optimisticUpdates)W=z.applyOptimisticVote(b,x,Z,_);try{let $=await K.put(`/topics/${j}/posts/${x}/vote`,{type:_?null:Z});if($.ok){let G=_?null:Z;if(z.setUserVote(x,G),W)W.commit();else j0(b,Z,_,J)}else throw new Error(`Vote request failed with status ${$.status}`)}catch($){if(W)W.rollback();if(X.ui.showErrorNotifications)Q.showError($);console.error("Failed to vote:",$)}finally{z.setVoteLoading(x,!1)}},X.performance.debounceMs);if(b.upvote)b.upvote.addEventListener("click",(Z)=>{Z.preventDefault(),Z.stopPropagation(),Y("like")});if(b.downvote)b.downvote.addEventListener("click",(Z)=>{Z.preventDefault(),Z.stopPropagation(),Y("dislike")})}function u(b,x,j,K){let z=new Map,X=new Map;b.forEach((Q)=>{let Y=Q.postId.toString(),Z=Q.voteType;if(!z.has(Y))z.set(Y,{like:0,dislike:0});let _=z.get(Y);if(_[Z]=(_[Z]||0)+1,j&&Q.userId===j.userId)X.set(Y,Z),K.setUserVote(Y,Z)}),x.forEach((Q,Y)=>{let Z=z.get(Y)||{like:0,dislike:0},_=X.get(Y);if(Q.upvote){let J=Q.upvote.querySelector(".reactions-votes-count");q(J,Z.like),F(Q.upvote,"reactions-user-choice",_==="like")}if(Q.downvote){let J=Q.downvote.querySelector(".reactions-votes-count");q(J,Z.dislike),F(Q.downvote,"reactions-user-choice",_==="dislike")}})}function m(b,x){if(!b.reactions)return null;let j=Object.assign(document.createElement("div"),{className:"reactions-reactions"}),K=Object.assign(document.createElement("div"),{className:"reactions-compact-view"}),z=Object.assign(document.createElement("div"),{className:"reactions-add-button",innerHTML:'<div class="reactions-add-button-icon">\uD83D\uDE0A</div>',title:"Add reaction"});z.setAttribute("role","button"),z.setAttribute("tabindex","0");let X=Object.assign(document.createElement("div"),{className:"reactions-compact-reactions"});K.appendChild(z),K.appendChild(X);let Q=Object.assign(document.createElement("div"),{className:"reactions-expanded-view"}),Y=Object.assign(document.createElement("div"),{className:"reactions-reactions-options"});Object.entries(b.customization.reactionIcons).forEach(([_,J])=>{let W=document.createElement("div");W.className="reactions-reactions-option",W.innerHTML=`<div class="reactions-reactions-option-icon">${J}</div>
			<div class="reactions-reactions-option-count" data-count="0">0</div>`,W.setAttribute("aria-label",_),W.setAttribute("role","button"),W.setAttribute("tabindex","0"),Y.appendChild(W);let $=document.createElement("div");$.className="reactions-compact-option",$.innerHTML=`<div class="reactions-compact-option-icon">${J}</div>
			<div class="reactions-compact-option-count" data-count="0">0</div>`,$.setAttribute("aria-label",_),$.setAttribute("role","button"),$.setAttribute("tabindex","0"),$.style.display="none",X.appendChild($)}),Q.appendChild(Y),j.appendChild(K),j.appendChild(Q);let Z;return j.addEventListener("mouseenter",()=>{clearTimeout(Z),j.classList.add("reactions-expanded")}),j.addEventListener("mouseleave",()=>{Z=setTimeout(()=>{j.classList.remove("reactions-expanded")},150)}),x.appendChild(j),j}function r(b,x,j,K,z,X){if(!b.reactions)return;let Q=b.reactions.querySelectorAll(".reactions-reactions-option"),Y=b.reactions.querySelectorAll(".reactions-compact-option"),Z=b.reactions.querySelector(".reactions-add-button");if([...Array.from(Q),...Array.from(Y)].forEach((J)=>{J.addEventListener("click",async(W)=>{if(W.preventDefault(),W.stopPropagation(),z.isReactionLoading(x))return;z.setReactionLoading(x,!0);try{let $=J.getAttribute("aria-label"),G=J.classList.contains("reactions-user-choice"),L=z.getUserReaction(x);if((await K.put(`/topics/${j}/posts/${x}/reaction`,{reaction:G?null:$})).ok){let A=G?null:$;if(z.setUserReaction(x,A),D([...Array.from(Q),...Array.from(Y)],"reactions-user-choice"),!G){let h=Array.from(Q).find((V)=>V.getAttribute("aria-label")===$),I=Array.from(Y).find((V)=>V.getAttribute("aria-label")===$);if(h)h.classList.add("reactions-user-choice");if(I)I.classList.add("reactions-user-choice")}if(L&&L!==$)T(Q,Y,L,-1),T(Q,Y,$,1);else if(L===$)T(Q,Y,$,-1);else if(!L)T(Q,Y,$,1);if(b.reactions)p(b.reactions)}}catch($){console.error("Failed to react:",$)}finally{z.setReactionLoading(x,!1)}})}),Z)Z.addEventListener("click",(J)=>{J.preventDefault(),J.stopPropagation(),b.reactions?.classList.add("reactions-expanded")})}function T(b,x,j,K){let z=(Y)=>{let Z=Y.querySelector(".reactions-reactions-option-count, .reactions-compact-option-count");if(Z){let _=H(Z),J=Math.max(0,_+K);q(Z,J)}},X=Array.from(b).find((Y)=>Y.getAttribute("aria-label")===j);if(X)z(X);let Q=Array.from(x).find((Y)=>Y.getAttribute("aria-label")===j);if(Q)z(Q)}function p(b){let x=b.querySelector(".reactions-add-button"),j=b.querySelector(".reactions-compact-reactions"),K=b.querySelectorAll(".reactions-compact-option"),z=!1;if(K.forEach((X)=>{let Q=X.querySelector(".reactions-compact-option-count");if(H(Q)>0)X.style.display="flex",z=!0;else X.style.display="none"}),z)x.style.display="none",j.style.display="flex";else x.style.display="flex",j.style.display="none"}function a(b,x,j,K){let z=new Map,X=new Map;b.forEach((Q)=>{let Y=Q.postId.toString(),Z=Q.reaction;if(!z.has(Y))z.set(Y,new Map);let _=z.get(Y);if(_.set(Z,(_.get(Z)||0)+1),j&&Q.userId===j.userId)X.set(Y,Z),K.setUserReaction(Y,Z)}),x.forEach((Q,Y)=>{if(!Q.reactions)return;let Z=z.get(Y)||new Map,_=X.get(Y),J=Q.reactions.querySelectorAll(".reactions-reactions-option"),W=Q.reactions.querySelectorAll(".reactions-compact-option");J.forEach(($)=>{let G=$.getAttribute("aria-label"),L=Z.get(G)||0,B=$.querySelector(".reactions-reactions-option-count");q(B,L),F($,"reactions-user-choice",_===G)}),W.forEach(($)=>{let G=$.getAttribute("aria-label"),L=Z.get(G)||0,B=$.querySelector(".reactions-compact-option-count");q(B,L),F($,"reactions-user-choice",_===G)}),p(Q.reactions)})}async function E(b){let x=f(b),j=new URL(location.href),K=j.searchParams.get("showtopic")||(j.searchParams.get("act")==="ST"?j.searchParams.get("t"):null);if(!K)return;let z=C();g(R);let X=new O(x,K),Q=new U,Y=new Map;document.querySelectorAll(x.selectors.post).forEach((J)=>{let W=J.querySelector(x.selectors.reactionsContainer);if(!W)return;W.style.position="relative";let{votes:$,upvote:G,downvote:L}=c(x,W),B=m(x,W),A={post:J,reactionsContainer:W,votes:$,upvote:G,downvote:L,reactions:B||void 0},h=x.pidFn(A);Y.set(h,A),l(A,h,K,X,Q,x),r(A,h,K,X,Q,x)});let _=Array.from(Y.keys());if(x.reactions)try{let W=await(await X.get("/reactions",{query:{postIds:_.join(",")}})).json();a(W,Y,z,Q)}catch(J){console.error("Failed to load reactions:",J)}if(x.votes)try{let W=await(await X.get("/votes",{query:{postIds:_.join(",")}})).json();u(W,Y,z,Q)}catch(J){console.error("Failed to load votes:",J)}}window.Reactions=E;})();
